---
title: Mayotte
---

# Cartographie
```js
// Importation de Leaflet depuis npm pour gérer la carte
import * as L from "npm:leaflet";
import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7.6.1/dist/d3.min.js";
```

```js
import { calculateQuantiles, getColor, createStyle, onEachFeature, getWMSTileLayer} from "./components/fonctions.js";

```

```js
const statistics = FileAttachment("./data/clusters_statistics.json").json();
```

```js
// Extraction des valeurs pour les différentes statistiques
const geojsonData = statistics;
console.log(statistics)
```

```js
const quantileProbs = [0, 0.25, 0.5, 0.75, 1.0];

const colorScales = {
  greenScale: ['#E5FFE5', '#B2FFB2', '#66FF66', '#228B22', '#006400'],
  blueScale: ['#F0F8FF', '#ADD8E6', '#87CEFA', '#4682B4', '#00008B'],
  redScale: ['#FFF0F5', '#FFB6C1', '#FF69B4', '#FF1493', '#FF0066'],
  yellowScale: ['#FFFFCC', '#FEE391', '#FEC44F', '#FE9929', '#D95F0E']
};
```

```js
// Configuration des départements avec des coordonnées spécifiques et des couches supplémentaires
const departementConfig = {
  mayotte: {
    name: 'MAYOTTE',
    center: [-12.78081553844026, 45.227656507434695],
    availableYears: ['2023'],
  },
};

// Choix du département Mayotte
const departement = 'mayotte';
const config = departementConfig[departement];

const { name, center, availableYears } = config;

// Initialisation de la carte Leaflet
const mapDiv = display(document.createElement("div"));
mapDiv.style = "height: 600px; width: 100%; margin: 0 auto;";

// Initialiser la carte avec la position centrale du département
const map = L.map(mapDiv).setView(center, 14,10.4);

// Ajout d'une couche de base OpenStreetMap
const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors',
});

// Ajout d'une couche de base sombre pour le mode sombre
const darkBaseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors &copy; CartoDB',
  subdomains: 'abcd',
  maxZoom: 19,
});

// Ajouter la couche de base par défaut
baseLayer.addTo(map);

// Création des groupes de couches de base et superposées
const baseLayers = {
  'Clair': baseLayer,
  'Sombre': darkBaseLayer,
};

const overlays = {};

// Ajout des couches pour les années disponibles
for (const year of availableYears) {
  const pleiadesLayer = getWMSTileLayer(`${name}_${year}`);
  overlays[`PLEIADES ${year}`] = pleiadesLayer;

  const predictionLayer = getWMSTileLayer(`${name}_PREDICTIONS_${year}`);
  overlays[`Prédiction ${year}`] = predictionLayer;
}


```


```js
let values = statistics.features.map(f => f.properties.pct_building_2023);
const quantiles = calculateQuantiles(values, quantileProbs);
const colorScale  = colorScales.redScale;
const style = createStyle(quantiles, colorScale);

// Création de la couche GeoJSON et ajout à la carte
const geojsonLayer = L.geoJson(statistics, {
  style: style,
  onEachFeature: onEachFeature
}).addTo(map);

// Définition des couches de base et des superpositions
const baseLayers = {
  'OSM': baseLayer,
  'Sombre': darkBaseLayer,
};
overlays['Pourcentage de bâti 2023'] = geojsonLayer

// Ajout du contrôle des couches à la carte
L.control.layers(baseLayers, overlays).addTo(map);
```

```js
// Création de la légende
const legend = L.control({ position: 'bottomright' });

legend.onAdd = function (map) {
  const div = L.DomUtil.create('div', 'info legend');
  const labels = [];

  // Titre de la légende
  div.innerHTML += '<h4 style="color:black; text-shadow: -1px 0px 1px white, 0px -1px 1px white, 1px 0px 1px white, 0px 1px 1px white;">Pourcentage de bâti 2023 (%)</h4>';

  // Boucle pour générer les intervalles de la légende en utilisant les quantiles
  for (let i = 0; i < quantiles.length - 1; i++) {
    const from = quantiles[i];
    const to = quantiles[i + 1];
    const color = colorScale[i]; 

    labels.push(
      '<i style="background:' + color + '; width:18px; height:18px; float:left; margin-right:8px; opacity:1;"></i> ' +
      '<span style="color:black; text-shadow: -1px 0px 1px white, 0px -1px 1px white, 1px 0px 1px white, 0px 1px 1px white;">' +
      Math.round(from) + ' &ndash; ' + Math.round(to) +
      '</span>'
    );
  }

  div.innerHTML += labels.join('<br>');

  // Rendre la légende complètement opaque et bien visible
  div.style.opacity = '1';
  div.style.backgroundColor = 'white'; // Ajouter un fond blanc pour la légende
  div.style.padding = '8px'; // Ajouter un padding pour une meilleure lisibilité
  div.style.borderRadius = '5px'; // Coins arrondis
  div.style.boxShadow = '0 0 15px rgba(0, 0, 0, 0.2)'; // Ajout d'une ombre

  return div;
};

// Vérification initiale de l'état de la couche et ajout de la légende si nécessaire
if (map.hasLayer(overlays['Pourcentage de bâti 2023'])) {
  legend.addTo(map);
}

// Ajout des événements pour afficher ou masquer la légende
map.on('overlayadd', function (eventLayer) {
  if (eventLayer.name === 'Pourcentage de bâti 2023') {
    legend.addTo(map);
  }
});

map.on('overlayremove', function (eventLayer) {
  if (eventLayer.name === 'Pourcentage de bâti 2023') {
    map.removeControl(legend);
  }
});

// VARIABILISER !! routing dynamique !!
// UTILISER DES FONCTIONS GENERIQUES OU LES STOCKER ? COMPONENTS
// CI - CD et publication
// tableau de statistiques interactives avec sélection des ilots de Jean françois
// Tableau
// ne sélectionner qu'une couche pleiades à la fois,
// slider avant après pour les cartes leaflet
// + site internet
```



